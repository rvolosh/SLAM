---
title: "test SLAM functions"
output: rmarkdown::html_vignette
vignette: >
%\VignetteIndexEntry{test SLAM functions}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  ---
  
  ```{r, include = FALSE}
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>"
)
```

```{r setup}
library(SLAM)
```

## Test merge_diftime


```{r}
# Example Merging clostest NMR to Glucose --------------------------------------

# Checkout data --------------------------------------------------------------
# Checkout census
head(data_SLAM_census)

# Checkout glucose
head(data_SLAM_gluc)

# Checkout nmr
head(data_SLAM_nmr)

# Create gluc ----------------------------------------------------------------
# join glucose and census for dob and other infor
gluc <- dplyr::left_join(data_SLAM_gluc, data_SLAM_census, by = "idno")
# drop useless vars
gluc <- dplyr::select(gluc, -c(lact, cohort, animal_id, tag, taghistory, cage, eartag, name, X))
# create age for merging and format data so it makes sense
gluc <- dplyr::mutate(gluc,
                      age_wk = difftime(date, dob, units = "weeks"),
                      date = as.Date(date, "%m%d%Y")
)

# Create nmr -----------------------------------------------------------------
# join nmr with census for dob and other info
nmr <- dplyr::left_join(data_SLAM_nmr, data_SLAM_census, by = "idno")
# drop useless columns
nmr <- dplyr::select(nmr, -c(cohort, animal_id, tag, taghistory, cage, eartag, name, X))
# create age for merging and format data so it makes sense
nmr <- dplyr::mutate(nmr,
                     age_wk = difftime(date, dob, units = "weeks"),
                     date = as.Date(date, "%m%d%Y")
)

# Use merge_diftime ----------------------------------------------------------
gluc_nmr <- merge_diftime(
  data1 = gluc,
  data2 = nmr,
  id = "idno",
  age = "age_wk",
  vars = c("bw", "lean", "fluid", "fat"),
  clean_vars = FALSE)

# Checkout results
head(gluc_nmr)

```

